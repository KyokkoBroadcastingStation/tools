<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <link rel="stylesheet" href="style/main-style.css" />
    <link rel="stylesheet" href="style/business-card.css" />
    <!-- ogp -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="名刺ジェネレーター 丨 KBS情報通信ネットワーク" />
    <meta property="og:site_name" content="KBS 北海道旭川工業高等学校 放送局 情報通信ネットワーク" />
    <meta
      property="og:description"
      content="簡単、名刺作成。Web上で簡単に名刺を作成することができます。A4サイズ、名刺サイズ出力に対応。"
    />
    <title>名刺ジェンレーター 丨 KBS情報通信ネットワーク</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* タブスタイル */
      .tab-container {
        max-width: 1500px;
        margin: 20px auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .tab-header {
        display: flex;
        background: #f8f9fa;
        border-bottom: 2px solid #e1e8ed;
      }

      .tab-button {
        flex: 1;
        padding: 20px;
        background: transparent;
        border: none;
        font-size: 18px;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
      }

      .tab-button:hover {
        background: #f0f4f8;
        color: #333;
      }

      .tab-button.active {
        color: #667eea;
        background: white;
      }

      .tab-button.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, #667eea, #764ba2);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* A4出力用スタイル */
      .container-a4 {
        max-width: 1500px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        padding: 20px;
      }

      /* 名刺サイズ出力用スタイル */
      .container-card {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 20px;
      }

      .input-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .container-title {
        font-size: 24px;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }

      .current-person {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 10px 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 14px;
      }

      .form-group input {
        width: 100%;
        padding: 10px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .form-group input:focus {
        outline: none;
        border-color: #667eea;
      }

      button {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 10px;
      }

      .add-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .add-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .reset-btn {
        background: #e74c3c;
        color: white;
      }

      .reset-btn:hover {
        background: #c0392b;
      }

      .download-btn {
        background: #27ae60;
        color: white;
      }

      .download-btn:hover {
        background: #229954;
      }

      .preview-section {
        padding: 20px;
        width: 100%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .preview-section-card {
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #e3f2fd, #f8f9ff);
        border-radius: 15px;
        border: 2px solid #e1e8ed;
      }

      .person-list {
        background: #f0f4f8;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        overflow: auto;
        max-height: 50vh;
      }

      .person-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: white;
        border-radius: 6px;
        margin-bottom: 8px;
        font-size: 14px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .person-name {
        font-weight: 600;
        color: #333;
      }

      .person-details {
        color: #666;
        font-size: 12px;
      }

      .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 12px;
        width: auto;
        margin: 0;
      }

      .delete-btn:hover {
        background: #c82333;
      }

      .live-preview {
        background: linear-gradient(135deg, #e3f2fd, #f8f9ff);
        padding: 20px;
        border-radius: 15px;
        border: 2px solid #e1e8ed;
      }

      .live-preview h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 18px;
        text-align: center;
        font-weight: 600;
      }

      .a4-container {
        width: 100%;
        background: white;
        transform-origin: top center;
        flex-shrink: 1;
        transform: scale(0.6);
        margin: 0 auto;
      }

      .a4-title {
        text-align: center;
        color: #333;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .card-grid {
        position: absolute;
        top: 10mm;
        left: 50%;
        transform: translateX(-50%);
        width: 184mm;
        height: 277mm;
        display: grid;
        grid-template-columns: 92mm 92mm;
        grid-template-rows: repeat(5, 55mm);
      }

      .card-slot {
        position: relative;
        width: 92mm;
        height: 55mm;
        border: 1px dashed #e9bb51;
      }

      .card-slot::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 1px dashed #e9bb51;
        pointer-events: none;
        z-index: 100;
      }

      .business-card.pdf-generation {
        width: 92mm !important;
        height: 55mm !important;
        transform: none !important;
        box-shadow: none !important;
      }

      @media (max-width: 768px) {
        .container-a4 {
          grid-template-columns: 1fr;
          width: 95%;
        }
        .container-card {
          grid-template-columns: 1fr;
          max-width: 500px;
        }
        .input-section {
          padding: 20px;
        }
        .a4-container {
          transform: scale(0.5);
        }
        .tab-button {
          font-size: 14px;
          padding: 15px 10px;
        }
      }
    </style>
  </head>
  <body>
    <!--header-->
    <div id="header"></div>
    <script>
      fetch("Components/header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header").innerHTML = html;
        });
    </script>
    <!--header-->

    <div class="tab-container">
      <div class="tab-header">
        <button class="tab-button active" onclick="switchTab('a4')">
          A4サイズ出力（最大10人）
        </button>
        <button class="tab-button" onclick="switchTab('card')">
          名刺サイズ出力（1人）
        </button>
      </div>

      <!-- A4出力タブ -->
      <div id="tab-a4" class="tab-content active">
        <div class="container-a4">
          <div class="input-section">
            <h1 class="container-title">個人情報入力</h1>

            <div class="current-person">
              人数: <span id="personCount">0</span>/10
            </div>

            <form id="cardFormA4">
              <div class="form-group">
                <label for="nameA4">名前</label>
                <input type="text" id="nameA4" placeholder="例：田中 太郎" />
              </div>

              <div class="form-group">
                <label for="readingA4">読み仮名</label>
                <input
                  type="text"
                  id="readingA4"
                  placeholder="例：Tarou Tanaka"
                />
              </div>

              <div class="form-group">
                <label for="departmentA4">部署</label>
                <input type="text" id="departmentA4" placeholder="例：局長" />
              </div>

              <div class="form-group">
                <label for="gradeA4">学年・学科</label>
                <input type="text" id="gradeA4" placeholder="例：4年自動車科" />
              </div>

              <hr
                style="
                  margin: 20px 0;
                  border: none;
                  border-top: 2px solid #e1e8ed;
                "
              />

              <h1 class="container-title">共通連絡先情報</h1>

              <div class="form-group">
                <label for="organizationA4">組織名</label>
                <input
                  type="text"
                  id="organizationA4"
                  value="北海道旭川工業高等学校 放送局 / KBS 旭工放送局"
                />
              </div>

              <div class="form-group">
                <label for="contactA4">連絡先情報（複数行入力可）</label>
                <textarea
                  id="contactA4"
                  rows="6"
                  style="
                    width: 100%;
                    padding: 10px;
                    border: 2px solid #e1e8ed;
                    border-radius: 8px;
                    font-size: 14px;
                    font-family: inherit;
                    resize: vertical;
                  "
                >
〒078-8804
北海道旭川市緑が丘東4条1丁目1－1　2階 放送室
E-mail:kbs.ahkc@gmail.com
X(旧:Twitter):https://x.com/kbs_asahikawa
http://www.kyokko.hokkaido-c.ed.jp/z20/r32</textarea
                >
              </div>

              <button type="button" class="add-btn" onclick="addPerson()">
                スタッフを追加
              </button>

              <button type="button" class="reset-btn" onclick="resetAll()">
                すべてリセット
              </button>

              <button
                type="button"
                class="download-btn"
                onclick="downloadA4PDF()"
              >
                A4でPDFダウンロード
              </button>
            </form>
          </div>

          <div class="live-preview">
            <h3>入力データ プレビュー</h3>
            <div class="preview-card-container">
              <div class="preview-business-card" id="livePreviewCardA4"></div>
            </div>
            <div class="person-list" id="personList" style="display: none">
              <h3 style="margin-bottom: 10px; color: #333">登録済みスタッフ</h3>
              <div id="personItems"></div>
            </div>
          </div>

          <div class="preview-section">
            <div class="a4-title">A4印刷プレビュー</div>
            <div class="a4-container" id="a4Container">
              <div class="card-grid" id="cardGrid"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 名刺サイズ出力タブ -->
      <div id="tab-card" class="tab-content">
        <div class="container-card">
          <div class="input-section">
            <h1 class="container-title">名刺ジェネレーター</h1>

            <form id="cardFormCard">
              <div class="form-group">
                <label for="nameCard">名前</label>
                <input type="text" id="nameCard" placeholder="例:田中 太郎" />
              </div>

              <div class="form-group">
                <label for="readingCard">読み仮名</label>
                <input
                  type="text"
                  id="readingCard"
                  placeholder="例:Tarou Tanaka"
                />
              </div>

              <div class="form-group">
                <label for="departmentCard">部署</label>
                <input
                  type="text"
                  id="departmentCard"
                  placeholder="例:局長"
                />
              </div>

              <div class="form-group">
                <label for="gradeCard">学年・学科</label>
                <input type="text" id="gradeCard" placeholder="例:4年自動車科" />
              </div>

              <hr
                style="
                  margin: 20px 0;
                  border: none;
                  border-top: 2px solid #e1e8ed;
                "
              />

              <h1 class="container-title">連絡先情報</h1>

              <div class="form-group">
                <label for="organizationCard">組織名</label>
                <input
                  type="text"
                  id="organizationCard"
                  value="北海道旭川工業高等学校 放送局 / KBS 旭工放送局"
                />
              </div>

              <div class="form-group">
                <label for="contactCard">連絡先情報（複数行入力可）</label>
                <textarea
                  id="contactCard"
                  rows="6"
                  style="
                    width: 100%;
                    padding: 10px;
                    border: 2px solid #e1e8ed;
                    border-radius: 8px;
                    font-size: 14px;
                    font-family: inherit;
                    resize: vertical;
                  "
                >
〒078-8804
北海道旭川市緑が丘東4条1丁目1－1　2階 放送室
E-mail:kbs.ahkc@gmail.com
X(旧:Twitter):https://x.com/kbs_asahikawa
http://www.kyokko.hokkaido-c.ed.jp/z20/r32</textarea
                >
              </div>

              <button type="button" class="reset-btn" onclick="resetFormCard()">
                入力をリセット
              </button>

              <button
                type="button"
                class="download-btn"
                onclick="downloadCardPDF()"
              >
                名刺をPDFでダウンロード
              </button>
            </form>
          </div>

          <div class="preview-section-card">
            <div>
              <h3>プレビュー</h3>
              <div class="preview-card-container">
                <div
                  class="preview-business-card"
                  id="livePreviewCardCard"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // タブ切り替え機能
      function switchTab(tabName) {
        // すべてのタブコンテンツを非表示
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // すべてのタブボタンを非アクティブ
        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("active");
        });

        // 選択されたタブを表示
        document.getElementById(`tab-${tabName}`).classList.add("active");
        event.target.classList.add("active");
      }

      // A4出力用のコード
      let staffList = [];
      let commonContactInfo = {};

      function initA4() {
        generateCardSlots();
        saveCommonContactInfo();
        updateLivePreviewA4();
        updateDisplay();
        setupInputListenersA4();
      }

      function setupInputListenersA4() {
        const inputs = [
          "nameA4",
          "readingA4",
          "departmentA4",
          "gradeA4",
          "organizationA4",
          "contactA4",
        ];
        inputs.forEach((id) => {
          document.getElementById(id).addEventListener("input", () => {
            updateLivePreviewA4();
            if (["organizationA4", "contactA4"].includes(id)) {
              saveCommonContactInfo();
            }
          });
        });
      }

      function saveCommonContactInfo() {
        commonContactInfo = {
          organization: document.getElementById("organizationA4").value.trim(),
          contact: document.getElementById("contactA4").value.trim(),
        };
      }

      function updateLivePreviewA4() {
        const name = document.getElementById("nameA4").value.trim();
        const reading = document.getElementById("readingA4").value.trim();
        const department = document.getElementById("departmentA4").value.trim();
        const grade = document.getElementById("gradeA4").value.trim();

        const previewCard = document.getElementById("livePreviewCardA4");
        previewCard.className = "preview-business-card";
        previewCard.innerHTML = createCardContent({
          name: name || "名前未入力",
          reading: reading || "読み仮名未入力",
          department: department || "部署未入力",
          grade: grade || "学年・学科未入力",
          ...commonContactInfo,
        });
      }

      function generateCardSlots() {
        const cardGrid = document.getElementById("cardGrid");
        cardGrid.innerHTML = "";

        for (let i = 0; i < 10; i++) {
          const slot = document.createElement("div");
          slot.className = "card-slot";
          slot.id = `slot-${i}`;
          cardGrid.appendChild(slot);
        }
      }

      function addPerson() {
        if (staffList.length >= 10) {
          alert("最大10人まで登録できます。");
          return;
        }

        const name = document.getElementById("nameA4").value.trim();
        const reading = document.getElementById("readingA4").value.trim();
        const department = document.getElementById("departmentA4").value.trim();
        const grade = document.getElementById("gradeA4").value.trim();

        if (!name || !reading || !department || !grade) {
          alert("名前、読み仮名、部署、学年・学科は必須項目です。");
          return;
        }

        saveCommonContactInfo();

        const staff = {
          id: Date.now(),
          name: name,
          reading: reading,
          department: department,
          grade: grade,
          ...commonContactInfo,
        };

        staffList.push(staff);
        updateDisplay();
        updateLivePreviewA4();
      }

      function deletePerson(id) {
        staffList = staffList.filter((staff) => staff.id !== id);
        updateDisplay();
      }

      function clearFormA4() {
        document.getElementById("nameA4").value = "";
        document.getElementById("readingA4").value = "";
        document.getElementById("departmentA4").value = "";
        document.getElementById("gradeA4").value = "";
      }

      function resetAll() {
        staffList = [];
        clearFormA4();
        updateDisplay();
        updateLivePreviewA4();
      }

      function updateDisplay() {
        updatePersonCount();
        updatePersonList();
        updateCardGrid();
      }

      function updatePersonCount() {
        document.getElementById("personCount").textContent = staffList.length;
      }

      function updatePersonList() {
        const personList = document.getElementById("personList");
        const personItems = document.getElementById("personItems");

        if (staffList.length === 0) {
          personList.style.display = "none";
          return;
        }

        personList.style.display = "block";
        personItems.innerHTML = "";

        staffList.forEach((staff) => {
          const item = document.createElement("div");
          item.className = "person-item";
          item.innerHTML = `
            <div>
              <div class="person-name">${staff.name}</div>
              <div class="person-details">${staff.department} - ${staff.grade}</div>
            </div>
            <button class="delete-btn" onclick="deletePerson(${staff.id})">削除</button>
          `;
          personItems.appendChild(item);
        });
      }

      function updateCardGrid() {
        for (let i = 0; i < 10; i++) {
          const slot = document.getElementById(`slot-${i}`);

          if (i < staffList.length) {
            const staff = staffList[i];
            slot.innerHTML = createBusinessCard(staff);
          } else {
            slot.innerHTML = "";
          }
        }
      }

      function createCardContent(staff) {
        const contactLines = (staff.contact || "")
          .split("\n")
          .map((line) => line.trim())
          .filter((line) => line)
          .join("<br>");

        return `
          <div class="card-header">
            <div class="card-department">${staff.department}</div>
            <div class="card-grade">${staff.grade}</div>
          </div>
          <div class="card-name-section">
            <div class="card-name">${staff.name}</div>
            <div class="card-reading">${staff.reading}</div>
          </div>
          <div class="card-company-name">
            ${
              staff.organization ||
              "北海道旭川工業高等学校 放送局 / KBS 旭工放送局"
            }
          </div>
          <div class="card-footer">
            ${
              contactLines ||
              "〒078-8804<br>北海道旭川市緑が丘東4条1丁目1－1　2階 放送室<br>E-mail:kbs.ahkc@gmail.com<br>X(旧:Twitter):https://x.com/kbs_asahikawa<br>http://www.kyokko.hokkaido-c.ed.jp/z20/r32"
            }
          </div>
          <img class="card-logo" src="img/logo.png" alt="Logo" />
        `;
      }

      function createBusinessCard(staff) {
        return `<div class="business-card">${createCardContent(staff)}</div>`;
      }

      function downloadA4PDF() {
        if (staffList.length === 0) {
          alert("スタッフを追加してからPDFをダウンロードしてください。");
          return;
        }

        const pdfContainer = document.createElement("div");
        pdfContainer.style.cssText = `
          position: fixed;
          top: -9999px;
          left: -9999px;
          width: 210mm;
          height: 297mm;
          background: white;
          font-family: Arial, sans-serif;
        `;

        const pdfCardGrid = document.createElement("div");
        pdfCardGrid.style.cssText = `
          position: absolute;
          top: 10mm;
          left: 50%;
          transform: translateX(-50%);
          width: 184mm;
          height: 277mm;
          display: grid;
          grid-template-columns: 92mm 92mm;
          grid-template-rows: repeat(5, 55mm);
          grid-gap: 0;
        `;

        for (let i = 0; i < 10; i++) {
          const cardSlot = document.createElement("div");
          cardSlot.style.cssText = `
            position: relative;
            width: 92mm;
            height: 55mm;
            border: 1px dashed #e9bb51;
          `;

          if (i % 2 === 1) {
            cardSlot.style.borderLeft = "none";
          }
          if (i >= 2) {
            cardSlot.style.borderTop = "none";
          }

          if (i < staffList.length) {
            cardSlot.innerHTML = createBusinessCard(staffList[i]);
          }

          pdfCardGrid.appendChild(cardSlot);
        }

        pdfContainer.appendChild(pdfCardGrid);
        document.body.appendChild(pdfContainer);

        const imagesToLoad = [];
        const cardLogos = pdfContainer.querySelectorAll(".card-logo");

        cardLogos.forEach((logo) => {
          if (!logo.complete) {
            imagesToLoad.push(
              new Promise((resolve) => {
                logo.onload = resolve;
                logo.onerror = resolve;
              })
            );
          }
        });

        Promise.all(imagesToLoad).then(() => {
          setTimeout(() => {
            html2canvas(pdfContainer, {
              backgroundColor: "white",
              scale: 2,
              useCORS: true,
              allowTaint: false,
              width: 794,
              height: 1123,
              logging: false,
            })
              .then(function (canvas) {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                  orientation: "portrait",
                  unit: "mm",
                  format: "a4",
                });

                const imgData = canvas.toDataURL("image/png", 1.0);
                pdf.addImage(imgData, "PNG", 0, 0, 210, 297);

                const filename = `business-cards-${
                  new Date().toISOString().split("T")[0]
                }.pdf`;
                pdf.save(filename);

                document.body.removeChild(pdfContainer);
              })
              .catch(function (error) {
                console.error("PDF生成エラー:", error);
                alert("PDFの生成に失敗しました。再度お試しください。");

                if (document.body.contains(pdfContainer)) {
                  document.body.removeChild(pdfContainer);
                }
              });
          }, 300);
        });
      }

      // 名刺サイズ出力用のコード
      function initCard() {
        updateLivePreviewCard();
        setupInputListenersCard();
      }

      function setupInputListenersCard() {
        const inputs = [
          "nameCard",
          "readingCard",
          "departmentCard",
          "gradeCard",
          "organizationCard",
          "contactCard",
        ];
        inputs.forEach((id) => {
          document
            .getElementById(id)
            .addEventListener("input", updateLivePreviewCard);
        });
      }

      function updateLivePreviewCard() {
        const name = document.getElementById("nameCard").value.trim();
        const reading = document.getElementById("readingCard").value.trim();
        const department = document
          .getElementById("departmentCard")
          .value.trim();
        const grade = document.getElementById("gradeCard").value.trim();
        const organization = document
          .getElementById("organizationCard")
          .value.trim();
        const contact = document.getElementById("contactCard").value.trim();

        const previewCard = document.getElementById("livePreviewCardCard");
        previewCard.className = "preview-business-card";
        previewCard.innerHTML = createCardContent({
          name: name || "名前未入力",
          reading: reading || "読み仮名未入力",
          department: department || "部署未入力",
          grade: grade || "学年・学科未入力",
          organization: organization,
          contact: contact,
        });
      }

      function resetFormCard() {
        document.getElementById("nameCard").value = "";
        document.getElementById("readingCard").value = "";
        document.getElementById("departmentCard").value = "";
        document.getElementById("gradeCard").value = "";
        updateLivePreviewCard();
      }

      function downloadCardPDF() {
        const name = document.getElementById("nameCard").value.trim();
        const reading = document.getElementById("readingCard").value.trim();
        const department = document
          .getElementById("departmentCard")
          .value.trim();
        const grade = document.getElementById("gradeCard").value.trim();

        if (!name || !reading || !department || !grade) {
          alert("名前、読み仮名、部署、学年・学科を入力してください。");
          return;
        }

        const organization = document
          .getElementById("organizationCard")
          .value.trim();
        const contact = document.getElementById("contactCard").value.trim();

        const cardData = {
          name: name,
          reading: reading,
          department: department,
          grade: grade,
          organization: organization,
          contact: contact,
        };

        const pdfContainer = document.createElement("div");
        pdfContainer.style.cssText = `
          position: fixed;
          top: -9999px;
          left: -9999px;
          width: 92mm;
          height: 55mm;
          background: white;
          font-family: Arial, sans-serif;
        `;

        const businessCard = document.createElement("div");
        businessCard.className = "business-card pdf-generation";
        businessCard.innerHTML = createCardContent(cardData);
        pdfContainer.appendChild(businessCard);
        document.body.appendChild(pdfContainer);

        const cardLogo = businessCard.querySelector(".card-logo");
        const imagesToLoad = [];

        if (cardLogo && !cardLogo.complete) {
          imagesToLoad.push(
            new Promise((resolve) => {
              cardLogo.onload = resolve;
              cardLogo.onerror = resolve;
            })
          );
        }

        Promise.all(imagesToLoad).then(() => {
          setTimeout(() => {
            html2canvas(businessCard, {
              backgroundColor: "white",
              scale: 4,
              useCORS: true,
              allowTaint: false,
              width: 345,
              height: 207,
              logging: false,
            })
              .then(function (canvas) {
                const { jsPDF } = window.jspdf;

                const cardWidthMM = 91;
                const cardHeightMM = 55;

                const pdf = new jsPDF({
                  orientation: "landscape",
                  unit: "mm",
                  format: [cardWidthMM, cardHeightMM],
                });

                const imgData = canvas.toDataURL("image/png", 1.0);
                pdf.addImage(imgData, "PNG", 0, 0, cardWidthMM, cardHeightMM);

                const filename = `business-card-${name.replace(/\s+/g, "-")}-${
                  new Date().toISOString().split("T")[0]
                }.pdf`;
                pdf.save(filename);

                document.body.removeChild(pdfContainer);
              })
              .catch(function (error) {
                console.error("PDF生成エラー:", error);
                alert("PDFの生成に失敗しました。再度お試しください。");

                if (document.body.contains(pdfContainer)) {
                  document.body.removeChild(pdfContainer);
                }
              });
          }, 300);
        });
      }

      // 初期化
      window.addEventListener("DOMContentLoaded", () => {
        initA4();
        initCard();
      });
    </script>

    <!--footer-->
    <div id="footer"></div>
    <script>
      fetch("Components/footer.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("footer").innerHTML = html;
        });
    </script>
    <!--footer-->
  </body>
</html>
